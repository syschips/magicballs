<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MagicBall - PvP Battle Game (No Cache)</title>
<link rel="stylesheet" href="css/style.css">
<script>
// すべてのキャッシュをクリア
if ('caches' in window) {
  caches.keys().then(names => {
    names.forEach(name => caches.delete(name));
  });
}
</script>
</head>
<body>
  <div id="container">
    <h1>MagicBall - PvP Battle</h1>
    
    <!-- ログイン/登録UI -->
    <div id="authUI" style="display:block;">
      <div class="auth-panel">
        <input type="text" id="usernameInput" placeholder="プレイヤー名" />
        <input type="password" id="passwordInput" placeholder="パスワード" />
        <button id="loginBtn" class="primary-btn">ログイン</button>
        <button id="registerBtn">新規登録</button>
        <button id="offlineBtn">オフラインで遊ぶ</button>
      </div>
    </div>
    
    <!-- キャラクター選択UI -->
    <div id="charSelectUI" style="display:none;">
      <button id="confirmCharBtn" class="primary-btn">決定</button>
      <button id="backToAuthBtn">戻る</button>
    </div>
    
    <!-- ルーム選択UI -->
    <div id="roomSelectUI" style="display:none;">
      <div class="room-panel">
        <h2>ルーム一覧</h2>
        <div id="roomList"></div>
        <button id="createRoomBtn" class="primary-btn">新規ルーム作成</button>
        <button id="backToCharBtn">戻る</button>
      </div>
      
      <!-- ルーム作成モーダル -->
      <div id="createRoomModal" style="display:none;">
        <div class="modal-content">
          <h3>新規ルーム作成</h3>
          <input type="text" id="roomNameInput" placeholder="ルーム名" />
          <select id="maxPlayersInput">
            <option value="2">2人</option>
            <option value="3">3人</option>
            <option value="4" selected>4人</option>
          </select>
          <select id="gameTimeInput">
            <option value="120">2分</option>
            <option value="180" selected>3分</option>
            <option value="300">5分</option>
          </select>
          <button id="confirmCreateRoomBtn" class="primary-btn">作成</button>
          <button id="cancelCreateRoomBtn">キャンセル</button>
        </div>
      </div>
    </div>
    
    <!-- 待機ルームUI -->
    <div id="waitingRoomUI" style="display:none;">
      <h2 id="waitingRoomName">ルーム待機中</h2>
      <div id="participantList"></div>
      <button id="readyBtn" class="primary-btn">準備完了</button>
      <button id="leaveRoomBtn">退出</button>
    </div>
    
    <!-- ゲームUI -->
    <div id="gameUI" style="display:none;">
      <canvas id="game"></canvas>
      <button id="returnToRoomBtn" style="display:none;">ルームに戻る</button>
    </div>
    
    <!-- ランキングUI -->
    <div id="rankingUI" style="display:none;">
      <h2>ランキング</h2>
      <button id="refreshRankingBtn">更新</button>
      <button id="backFromRankingBtn">戻る</button>
      <div id="rankingList"></div>
    </div>
    
    <!-- ランキングボタン（常時表示） -->
    <button id="showRankingBtn" style="position:fixed; top:10px; right:10px;">ランキング</button>

    <div id="howto">
      <h3>操作方法</h3>
      <p>P1: 矢印キー移動, スペースキーで発射</p>
      <p>P2: WASDキー移動, Fキーで発射</p>
      <ul>
        <li><strong style="color:#ff6666;">● +B (赤い円)</strong>：同時に設置できるボール数 +1</li>
        <li><strong style="color:#66ff66;">▲ +R (緑の三角)</strong>：爆発範囲 +1タイル</li>
        <li><strong style="color:#6666ff;">► +S (青い矢印)</strong>：プレーヤー移動速度 +0.5</li>
      </ul>
    </div>

    <div id="keybinds">
      <label>P1 発射: <input id="p1fire" value="space" size="5"></label>
      <label>P2 発射: <input id="p2fire" value="f" size="2"></label>
      <button id="applyKeys">キー適用</button>
    </div>
  </div>

<script type="module">
  // タイムスタンプでキャッシュバスティング
  const v = new Date().getTime();
  import(`./src/main.js?v=${v}`);
</script>
</body>
</html>
